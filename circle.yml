machine:
  node:
    version: 4.6.2
  environment:
    METEOR_PACKAGE_DIRS: ./packages
    TOOL_NODE_FLAGS: --max-old-space-size=2048
dependencies:
  override:
    - curl https://install.meteor.com | /bin/sh
    - npm run install
    - npm run prepare-deps
    - npm run reinstall
checkout:
  post:
#    - git submodule update --init --remote --merge
test:
  override:
    - npm run lint && meteor test --once --driver-package dispatch:mocha-phantomjs ./
deployment:
  staging:
    branch: "development"
    commands:
      - echo $STAGING_SETTINGS > settings-staging.json
      - echo $DEPLOYMENT_TOKEN > deployment_token.json
      - METEOR_SESSION_FILE=deployment_token.json DEPLOY_HOSTNAME=us-east-1.galaxy-deploy.meteor.com meteor deploy mailer.staging.pathable.com --settings settings-staging.json  
  production:
    branch: "master"
    commands:
      - echo $PROD_SETTINGS > settings-production.json
      - echo $DEPLOYMENT_TOKEN > deployment_token.json
      - METEOR_SESSION_FILE=deployment_token.json DEPLOY_HOSTNAME=us-east-1.galaxy-deploy.meteor.com meteor deploy mailer.pathable.co --settings settings-production.json